{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport BlockAlert from \"@/components/BlockAlert.vue\";\nimport BlockConfirmation from \"@/components/BlockConfirmation.vue\";\nimport { UsersService } from \"@/services/UsersService\";\nimport profilePicture from \"@/assets/user-profile-picture.png\";\nexport default {\n  name: \"ProfileUpdate\",\n  components: {\n    BlockAlert,\n    BlockConfirmation\n  },\n\n  data() {\n    return {\n      user: {\n        id: 0,\n        firstname: \"\",\n        lastname: \"\",\n        email: \"\",\n        password: \"\",\n        imageUrl: \"\"\n      },\n      imageBase64url: \"\",\n      defautlImageUrl: profilePicture,\n      imageFile: null,\n      revealAlert: false,\n      messageAlert: \"\",\n      revealConfirmation: false,\n      messageConfirmation: \"\"\n    };\n  },\n\n  computed: {\n    emailIsValid() {\n      let regex = /^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}$/;\n      return regex.test(this.user.email);\n    },\n\n    passwordIsValid() {\n      let regex = /((?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\\W]).{8,})/g;\n      return regex.test(this.user.password);\n    },\n\n    formIsValid() {\n      return this.user.email && this.emailIsValid || this.imageFile || this.user.password && this.passwordIsValid;\n    }\n\n  },\n\n  beforeMount() {\n    UsersService.getUserData().then(res => {\n      this.user = res.data.data;\n    }).catch(err => console.log(err));\n  },\n\n  methods: {\n    setBase64urlImage(e) {\n      this.imageFile = e.target.files[0];\n      const fileReader = new FileReader();\n      fileReader.readAsDataURL(this.imageFile);\n      fileReader.addEventListener(\"load\", () => {\n        this.imageBase64url = fileReader.result;\n      });\n    },\n\n    updateProfile() {\n      const formData = new FormData();\n\n      if (this.imageFile) {\n        formData.append(\"image\", this.imageFile);\n      }\n\n      if (this.user.email) {\n        formData.append(\"email\", this.user.email);\n      }\n\n      if (this.user.password) {\n        formData.append(\"password\", this.user.password);\n      }\n\n      UsersService.updateProfile(formData, this.user.id);\n      this.messageAlert = \"Le profil a été mis à jour\";\n      this.revealAlert = !this.revealAlert;\n    },\n\n    toggleAlert() {\n      this.revealAlert = !this.revealAlert;\n    },\n\n    showBlockConfirmation() {\n      this.messageConfirmation = \"Êtes-vous sûr de vouloir supprimer votre profil ?\";\n      this.revealConfirmation = !this.revealConfirmation;\n    },\n\n    emailAlert() {\n      this.messageAlert = \"Adresse email incorrecte\";\n      this.revealAlert = !this.revealAlert;\n    },\n\n    passwordAlert() {\n      this.messageAlert = \"Le mot de passe doit contenir au moins une majuscule, une minuscule, un chiffre et un caractère spécial. Il doit avoir une longueur minimale de 8 caractères\";\n      this.revealAlert = !this.revealAlert;\n    },\n\n    deleteProfile() {\n      UsersService.deleteProfile(this.user.id);\n      this.$router.push(\"/\");\n    },\n\n    toggleConfirmation() {\n      this.revealConfirmation = !this.revealConfirmation;\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["BlockAlert","BlockConfirmation","UsersService","profilePicture","name","components","data","user","id","firstname","lastname","email","password","imageUrl","imageBase64url","defautlImageUrl","imageFile","revealAlert","messageAlert","revealConfirmation","messageConfirmation","computed","emailIsValid","regex","test","passwordIsValid","formIsValid","beforeMount","getUserData","then","res","catch","err","console","log","methods","setBase64urlImage","e","target","files","fileReader","FileReader","readAsDataURL","addEventListener","result","updateProfile","formData","FormData","append","toggleAlert","showBlockConfirmation","emailAlert","passwordAlert","deleteProfile","$router","push","toggleConfirmation"],"sourceRoot":"","sources":["/Users/clementstorne/Google Drive/OpenClassrooms/Dev-web/P7/groupomania-code/front/src/components/ProfileUpdate.vue"],"sourcesContent":["<template>\n  <div class=\"profile container py-3 px-3 col-12 py-md-3 px-md-5 col-md-10\">\n    <div class=\"profile-username text-center\">\n      <h2>{{ user.firstname }} {{ user.lastname }}</h2>\n    </div>\n    <div\n      class=\"profile-picture d-flex flex-column justify-content-center align-items-center mt-3 mb-5\"\n    >\n      <img\n        :src=\"imageBase64url\"\n        alt=\"Photo de profil de l'utilisateur\"\n        v-if=\"imageBase64url\"\n      />\n      <img\n        :src=\"user.imageUrl\"\n        alt=\"Photo de profil de l'utilisateur\"\n        v-else-if=\"user.imageUrl\"\n      />\n      <img\n        :src=\"defautlImageUrl\"\n        alt=\"Photo de profil de l'utilisateur\"\n        v-else\n      />\n      <div class=\"profile-picture-btn col-10 text-center\">\n        <input\n          type=\"file\"\n          name=\"image\"\n          id=\"profilePicture\"\n          accept=\"image/png, image/jpg, image/jpeg\"\n          class=\"profile-picture-btn-input\"\n          @change=\"setBase64urlImage\"\n        />\n        <button class=\"btn btn-primary col-12 mt-3\">\n          <label for=\"profilePicture\">Modifier la photo de profil</label>\n        </button>\n      </div>\n    </div>\n    <div class=\"profile-email mb-5 text-center\">\n      <div class=\"mb-2\">\n        <label for=\"email\" class=\"form-label\"\n          ><span v-if=\"!emailIsValid\" class=\"form-alert\" @click=\"emailAlert\">\n            ⚠️ </span\n          ><span v-else> ✅ </span>Email</label\n        >\n        <input\n          type=\"email\"\n          class=\"form-control\"\n          id=\"email\"\n          :placeholder=\"user.email\"\n          v-model=\"user.email\"\n        />\n      </div>\n    </div>\n    <div class=\"profile-password mb-5 text-center\">\n      <div class=\"mb-2\">\n        <label for=\"password\" class=\"form-label\"\n          ><span\n            v-if=\"!passwordIsValid\"\n            class=\"form-alert\"\n            @click=\"passwordAlert\"\n          >\n            ⚠️ </span\n          ><span v-else> ✅ </span>Mot de passe</label\n        >\n        <input\n          type=\"password\"\n          class=\"form-control\"\n          id=\"password\"\n          placeholder=\"********\"\n          v-model=\"user.password\"\n        />\n      </div>\n    </div>\n\n    <button\n      class=\"btn btn-primary col-12 mb-3\"\n      @click=\"updateProfile\"\n      :disabled=\"!formIsValid\"\n    >\n      Mettre à jour les informations\n    </button>\n\n    <div class=\"profile-delete mb-2\">\n      <button class=\"btn btn-secondary col-12\" @click=\"showBlockConfirmation\">\n        Supprimer le compte\n      </button>\n    </div>\n\n    <BlockAlert\n      :revealAlert=\"revealAlert\"\n      :toggleAlert=\"toggleAlert\"\n      :messageAlert=\"messageAlert\"\n    />\n    <BlockConfirmation\n      :revealConfirmation=\"revealConfirmation\"\n      :toggleConfirmation=\"toggleConfirmation\"\n      :messageConfirmation=\"messageConfirmation\"\n      @action=\"deleteProfile\"\n    />\n  </div>\n</template>\n\n<script>\nimport BlockAlert from \"@/components/BlockAlert.vue\";\nimport BlockConfirmation from \"@/components/BlockConfirmation.vue\";\n\nimport { UsersService } from \"@/services/UsersService\";\nimport profilePicture from \"@/assets/user-profile-picture.png\";\n\nexport default {\n  name: \"ProfileUpdate\",\n  components: {\n    BlockAlert,\n    BlockConfirmation,\n  },\n  data() {\n    return {\n      user: {\n        id: 0,\n        firstname: \"\",\n        lastname: \"\",\n        email: \"\",\n        password: \"\",\n        imageUrl: \"\",\n      },\n      imageBase64url: \"\",\n      defautlImageUrl: profilePicture,\n      imageFile: null,\n      revealAlert: false,\n      messageAlert: \"\",\n      revealConfirmation: false,\n      messageConfirmation: \"\",\n    };\n  },\n  computed: {\n    emailIsValid() {\n      let regex = /^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}$/;\n      return regex.test(this.user.email);\n    },\n    passwordIsValid() {\n      let regex = /((?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\\W]).{8,})/g;\n      return regex.test(this.user.password);\n    },\n    formIsValid() {\n      return (\n        (this.user.email && this.emailIsValid) ||\n        this.imageFile ||\n        (this.user.password && this.passwordIsValid)\n      );\n    },\n  },\n  beforeMount() {\n    UsersService.getUserData()\n      .then((res) => {\n        this.user = res.data.data;\n      })\n      .catch((err) => console.log(err));\n  },\n  methods: {\n    setBase64urlImage(e) {\n      this.imageFile = e.target.files[0];\n      const fileReader = new FileReader();\n      fileReader.readAsDataURL(this.imageFile);\n      fileReader.addEventListener(\"load\", () => {\n        this.imageBase64url = fileReader.result;\n      });\n    },\n    updateProfile() {\n      const formData = new FormData();\n      if (this.imageFile) {\n        formData.append(\"image\", this.imageFile);\n      }\n      if (this.user.email) {\n        formData.append(\"email\", this.user.email);\n      }\n      if (this.user.password) {\n        formData.append(\"password\", this.user.password);\n      }\n      UsersService.updateProfile(formData, this.user.id);\n      this.messageAlert = \"Le profil a été mis à jour\";\n      this.revealAlert = !this.revealAlert;\n    },\n    toggleAlert() {\n      this.revealAlert = !this.revealAlert;\n    },\n    showBlockConfirmation() {\n      this.messageConfirmation =\n        \"Êtes-vous sûr de vouloir supprimer votre profil ?\";\n      this.revealConfirmation = !this.revealConfirmation;\n    },\n    emailAlert() {\n      this.messageAlert = \"Adresse email incorrecte\";\n      this.revealAlert = !this.revealAlert;\n    },\n    passwordAlert() {\n      this.messageAlert =\n        \"Le mot de passe doit contenir au moins une majuscule, une minuscule, un chiffre et un caractère spécial. Il doit avoir une longueur minimale de 8 caractères\";\n      this.revealAlert = !this.revealAlert;\n    },\n    deleteProfile() {\n      UsersService.deleteProfile(this.user.id);\n      this.$router.push(\"/\");\n    },\n    toggleConfirmation() {\n      this.revealConfirmation = !this.revealConfirmation;\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\n.profile {\n  background-color: $white !important;\n  border-radius: 16px;\n  &-picture {\n    & img {\n      width: 150px;\n      height: 150px;\n      object-fit: cover;\n      border-radius: 50%;\n    }\n    &-btn {\n      position: relative;\n      overflow: hidden;\n      &-input {\n        position: absolute;\n        font-size: 50px;\n        opacity: 0;\n        right: 0;\n        top: 0;\n        bottom: 0;\n        left: 0;\n      }\n    }\n  }\n}\n.form {\n  &-label {\n    font-size: 16px;\n    font-weight: 400;\n    font-weight: 500;\n  }\n  &-control {\n    border: none;\n    padding: 12px;\n    background: $gray;\n    &:focus {\n      box-shadow: 0px 0px 0px 4px rgba($color-primary, 0.5);\n      outline: none;\n    }\n  }\n  &-alert {\n    cursor: pointer;\n  }\n}\n.btn {\n  font-weight: 700;\n  font-size: 16px;\n  border-radius: 8px;\n  border: none;\n  &-primary {\n    background: $color-tertiary;\n    &:hover {\n      background: darken($color-tertiary, 5%);\n    }\n    &:focus {\n      background: darken($color-tertiary, 5%);\n      box-shadow: 0px 0px 0px 4px rgba($color-tertiary, 0.5);\n      outline: none;\n    }\n    &:disabled {\n      background: $dark-gray;\n      outline: none;\n    }\n  }\n  &-secondary {\n    background: $color-primary;\n    &:hover {\n      background: darken($color-primary, 5%);\n    }\n    &:focus {\n      background: darken($color-primary, 5%);\n      box-shadow: 0px 0px 0px 4px rgba($color-primary, 0.5);\n      outline: none;\n    }\n  }\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}